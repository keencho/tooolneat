<!DOCTYPE html>
<html lang="ko">
<head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8846557285079359"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n-title="tools.jwtDecoder.title">JWT 디코더 - Toolneat</title>
  <meta name="description" data-i18n-desc="tools.jwtDecoder.description" content="JWT(JSON Web Token)를 온라인에서 무료로 디코딩하고 분석하세요. 토큰의 Header, Payload, Signature 세 부분을 분리하여 보여주고, 만료시간, 발급시간, 권한 등 클레임 정보를 읽기 쉽게 표시합니다. Secret Key로 서명 유효성을 검증할 수 있습니다.">

  <!-- Canonical & hreflang -->
  <link rel="canonical" href="https://toolneat.com/tools/dev/jwt-decoder/">
  <link rel="alternate" hreflang="ko" href="https://toolneat.com/tools/dev/jwt-decoder/">
  <link rel="alternate" hreflang="en" href="https://toolneat.com/en/tools/dev/jwt-decoder/">
  <link rel="alternate" hreflang="x-default" href="https://toolneat.com/tools/dev/jwt-decoder/">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Toolneat">
  <meta property="og:title" content="JWT 디코더 - Toolneat">
  <meta property="og:description" content="JWT(JSON Web Token)를 디코딩하여 Header, Payload, Signature를 확인합니다.">
  <meta property="og:url" content="https://toolneat.com/tools/dev/jwt-decoder/">
  <meta property="og:image" content="https://toolneat.com/assets/images/og-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2563eb">

  <!-- Favicon -->
  <!-- CSS -->
    <link rel="icon" href="/favicon.ico" sizes="48x48">
  <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="stylesheet" href="../../../assets/css/output.css">

  <!-- JS -->
  <script src="../../../assets/js/common.js"></script>
  <script src="../../../assets/js/i18n.js"></script>
  <script src="../../../assets/js/components.js"></script>

  <style>
    .jwt-part {
      padding: 1rem;
      border-radius: 0.75rem;
      margin-bottom: 1rem;
    }
    .jwt-header {
      background-color: #fef3c7;
      border: 1px solid #fcd34d;
    }
    .dark .jwt-header {
      background-color: #78350f;
      border-color: #92400e;
    }
    .jwt-payload {
      background-color: #dbeafe;
      border: 1px solid #93c5fd;
    }
    .dark .jwt-payload {
      background-color: #1e3a8a;
      border-color: #1d4ed8;
    }
    .jwt-signature {
      background-color: #fce7f3;
      border: 1px solid #f9a8d4;
    }
    .dark .jwt-signature {
      background-color: #831843;
      border-color: #9d174d;
    }
    .claim-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0.5rem 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .dark .claim-row {
      border-bottom-color: #374151;
    }
    .claim-row:last-child {
      border-bottom: none;
    }
    .claim-key {
      font-family: ui-monospace, monospace;
      font-weight: 600;
      color: #1f2937;
      min-width: 80px;
    }
    .dark .claim-key {
      color: #f3f4f6;
    }
    .claim-value {
      font-family: ui-monospace, monospace;
      color: #4b5563;
      word-break: break-all;
      text-align: right;
      flex: 1;
      margin-left: 1rem;
    }
    .dark .claim-value {
      color: #d1d5db;
    }
    .status-valid {
      color: #059669;
    }
    .status-expired {
      color: #dc2626;
    }
    .status-not-yet {
      color: #d97706;
    }
    .token-preview {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      word-break: break-all;
      line-height: 1.5;
    }
    .token-header { color: #d97706; }
    .token-payload { color: #2563eb; }
    .token-signature { color: #db2777; }
    .dark .token-header { color: #fbbf24; }
    .dark .token-payload { color: #60a5fa; }
    .dark .token-signature { color: #f472b6; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <div id="header"></div>

  <!-- Main Content -->
  <main class="flex-1 py-8 md:py-12">
    <div class="container-main">
      <!-- Page Title -->
      <div class="mb-6">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-2" data-i18n="tools.jwtDecoder.title">
          JWT 디코더
        </h1>
        <p class="text-gray-600 dark:text-gray-400" data-i18n="tools.jwtDecoder.descriptionLong">
          JWT(JSON Web Token)를 디코딩하여 Header, Payload, Signature를 확인합니다. 토큰의 만료 시간과 클레임 정보를 쉽게 확인할 수 있습니다.
        </p>
      </div>

      <!-- Ad Container (Top) -->
      <div class="ad-container mb-6">
        
      </div>

      <!-- Tool Card -->
      <div class="card">
        <!-- Input -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.inputLabel">JWT 토큰</label>
            <button id="paste-btn" class="text-sm text-blue-600 dark:text-blue-400 hover:underline" data-i18n="common.paste">붙여넣기</button>
          </div>
          <textarea id="jwt-input" class="textarea h-32 font-mono text-sm" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"></textarea>
        </div>

        <!-- Decode Button -->
        <button id="decode-btn" class="btn btn-primary w-full mb-6" data-i18n="tools.jwtDecoder.decode">디코딩</button>

        <!-- Error Message -->
        <div id="error-message" class="hidden mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400"></div>

        <!-- Results -->
        <div id="results" class="hidden">
          <!-- Token Status -->
          <div id="token-status" class="mb-6 p-4 rounded-xl"></div>

          <!-- Token Preview -->
          <div class="mb-6">
            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-i18n="tools.jwtDecoder.tokenStructure">토큰 구조</h3>
            <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-xl">
              <div id="token-preview" class="token-preview"></div>
            </div>
          </div>

          <!-- Header -->
          <div class="jwt-part jwt-header">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-medium text-amber-800 dark:text-amber-200">Header</h3>
              <button class="copy-part-btn text-amber-600 dark:text-amber-400 text-sm hover:underline" data-part="header" data-i18n="common.copy">복사</button>
            </div>
            <pre id="header-json" class="text-sm font-mono text-amber-900 dark:text-amber-100 whitespace-pre-wrap"></pre>
          </div>

          <!-- Payload -->
          <div class="jwt-part jwt-payload">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-medium text-blue-800 dark:text-blue-200">Payload</h3>
              <button class="copy-part-btn text-blue-600 dark:text-blue-400 text-sm hover:underline" data-part="payload" data-i18n="common.copy">복사</button>
            </div>
            <pre id="payload-json" class="text-sm font-mono text-blue-900 dark:text-blue-100 whitespace-pre-wrap"></pre>
          </div>

          <!-- Signature -->
          <div class="jwt-part jwt-signature">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-medium text-pink-800 dark:text-pink-200">Signature</h3>
              <button class="copy-part-btn text-pink-600 dark:text-pink-400 text-sm hover:underline" data-part="signature" data-i18n="common.copy">복사</button>
            </div>
            <code id="signature-value" class="text-sm font-mono text-pink-900 dark:text-pink-100 break-all"></code>

            <!-- Signature Verification -->
            <div class="mt-4 pt-4 border-t border-pink-200 dark:border-pink-700">
              <label class="block text-sm font-medium text-pink-800 dark:text-pink-200 mb-2" data-i18n="tools.jwtDecoder.secretKey">비밀키 (Secret Key)</label>
              <div class="flex gap-2">
                <input type="text" id="secret-key" class="input flex-1 font-mono text-sm bg-white dark:bg-gray-800" placeholder="your-256-bit-secret" data-i18n-placeholder="tools.jwtDecoder.secretKeyPlaceholder">
                <button id="verify-btn" class="btn btn-secondary shrink-0" data-i18n="tools.jwtDecoder.verify">검증</button>
              </div>
              <div id="verify-result" class="mt-2 hidden"></div>
              <p class="mt-2 text-xs text-pink-700 dark:text-pink-300" data-i18n="tools.jwtDecoder.signatureNote">HMAC 알고리즘(HS256, HS384, HS512)만 지원됩니다.</p>
            </div>
          </div>

          <!-- Claims Detail -->
          <div id="claims-section" class="mt-6">
            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3" data-i18n="tools.jwtDecoder.claimsDetail">클레임 상세</h3>
            <div id="claims-list" class="bg-gray-50 dark:bg-gray-900 rounded-xl p-4"></div>
          </div>
        </div>
      </div>

      <!-- Standard Claims Card -->
      <div class="card mt-6">
        <h3 class="font-medium text-gray-900 dark:text-white mb-4" data-i18n="tools.jwtDecoder.standardClaims">표준 클레임 (Registered Claims)</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div>
            <code class="text-blue-600 dark:text-blue-400">iss</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.iss">발급자 (Issuer)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">sub</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.sub">주제 (Subject)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">aud</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.aud">대상 (Audience)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">exp</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.exp">만료 시간 (Expiration)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">nbf</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.nbf">유효 시작 시간 (Not Before)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">iat</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.iat">발급 시간 (Issued At)</span>
          </div>
          <div>
            <code class="text-blue-600 dark:text-blue-400">jti</code>
            <span class="text-gray-600 dark:text-gray-400"> - </span>
            <span class="text-gray-700 dark:text-gray-300" data-i18n="tools.jwtDecoder.claim.jti">토큰 ID (JWT ID)</span>
          </div>
        </div>
      </div>

      <!-- Description Section -->
      <section class="mt-8 bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">JWT(JSON Web Token)란?</h2>
        <div class="prose prose-gray dark:prose-invert max-w-none text-sm">
          <p>JWT는 JSON 형식의 데이터를 안전하게 전송하기 위한 개방형 표준(RFC 7519)입니다. 주로 웹 애플리케이션에서 사용자 인증과 정보 교환에 사용됩니다. JWT는 Header(헤더), Payload(페이로드), Signature(서명) 세 부분으로 구성되며, 각 부분은 점(.)으로 구분됩니다. 서버는 비밀키를 사용하여 서명을 검증함으로써 토큰의 무결성을 확인할 수 있습니다.</p>

          <h3 class="text-lg font-semibold mt-6 mb-3">사용 방법</h3>
          <ol class="list-decimal list-inside space-y-2">
            <li>JWT 토큰을 입력창에 붙여넣습니다. (붙여넣기 시 자동으로 디코딩됩니다)</li>
            <li>'디코딩' 버튼을 클릭하면 Header, Payload, Signature가 분리되어 표시됩니다.</li>
            <li>토큰 상태(유효/만료)와 남은 시간을 확인할 수 있습니다.</li>
            <li>클레임 상세 섹션에서 각 클레임의 의미와 값을 확인합니다.</li>
            <li>서명을 검증하려면 비밀키를 입력하고 '검증' 버튼을 클릭하세요.</li>
          </ol>

          <h3 class="text-lg font-semibold mt-6 mb-3">자주 묻는 질문</h3>
          <div class="space-y-4">
            <div>
              <h4 class="font-medium">Q: JWT를 디코딩하면 내용이 노출되는데 안전한가요?</h4>
              <p>JWT의 Header와 Payload는 Base64로 인코딩되어 있어 누구나 디코딩할 수 있습니다. 따라서 민감한 정보(비밀번호 등)는 JWT에 포함하면 안 됩니다. JWT의 보안은 서명 검증에 있으며, 서명이 유효해야만 토큰을 신뢰할 수 있습니다.</p>
            </div>
            <div>
              <h4 class="font-medium">Q: exp, iat, nbf 클레임은 무엇인가요?</h4>
              <p>exp(Expiration)는 토큰 만료 시간, iat(Issued At)는 토큰 발급 시간, nbf(Not Before)는 토큰이 유효해지는 시작 시간입니다. 모두 Unix Timestamp(초 단위)로 표현됩니다.</p>
            </div>
            <div>
              <h4 class="font-medium">Q: RS256과 HS256의 차이점은?</h4>
              <p>HS256은 대칭키 알고리즘으로 같은 비밀키로 서명과 검증을 합니다. RS256은 비대칭키 알고리즘으로 개인키로 서명하고 공개키로 검증합니다. 이 도구는 HMAC(HS256/384/512) 알고리즘만 검증을 지원합니다.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Ad Container (Bottom) -->
      <div class="ad-container mt-8">
        
      </div>
    </div>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- Tool Script -->
  <script>
    (function() {
      'use strict';

      const jwtInput = document.getElementById('jwt-input');
      const pasteBtn = document.getElementById('paste-btn');
      const decodeBtn = document.getElementById('decode-btn');
      const errorMessage = document.getElementById('error-message');
      const results = document.getElementById('results');
      const tokenStatus = document.getElementById('token-status');
      const tokenPreview = document.getElementById('token-preview');
      const headerJson = document.getElementById('header-json');
      const payloadJson = document.getElementById('payload-json');
      const signatureValue = document.getElementById('signature-value');
      const claimsList = document.getElementById('claims-list');
      const secretKeyInput = document.getElementById('secret-key');
      const verifyBtn = document.getElementById('verify-btn');
      const verifyResult = document.getElementById('verify-result');

      let decodedData = {
        header: null,
        payload: null,
        signature: null
      };

      // Base64URL decode
      function base64UrlDecode(str) {
        // Replace URL-safe characters
        let base64 = str.replace(/-/g, '+').replace(/_/g, '/');

        // Pad with '='
        const pad = base64.length % 4;
        if (pad) {
          base64 += '='.repeat(4 - pad);
        }

        try {
          const decoded = atob(base64);
          // Handle UTF-8
          return decodeURIComponent(
            decoded.split('').map(c =>
              '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
            ).join('')
          );
        } catch (e) {
          throw new Error('Invalid Base64 encoding');
        }
      }

      // Get current language
      function getCurrentLang() {
        const params = new URLSearchParams(window.location.search);
        return params.get('lang') || 'ko';
      }

      // Format timestamp claim
      function formatTimestamp(ts) {
        const date = new Date(ts * 1000);
        const lang = getCurrentLang();
        return date.toLocaleString(lang === 'ko' ? 'ko-KR' : 'en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
      }

      // Check token status
      function getTokenStatus(payload) {
        const now = Math.floor(Date.now() / 1000);
        const lang = getCurrentLang();

        if (payload.exp) {
          if (payload.exp < now) {
            const expiredAgo = now - payload.exp;
            const days = Math.floor(expiredAgo / 86400);
            const hours = Math.floor((expiredAgo % 86400) / 3600);
            const mins = Math.floor((expiredAgo % 3600) / 60);

            let agoText;
            if (lang === 'ko') {
              agoText = days > 0 ? `${days}일 ${hours}시간 전` : hours > 0 ? `${hours}시간 ${mins}분 전` : `${mins}분 전`;
            } else {
              agoText = days > 0 ? `${days}d ${hours}h ago` : hours > 0 ? `${hours}h ${mins}m ago` : `${mins}m ago`;
            }

            return {
              status: 'expired',
              message: lang === 'ko' ? `만료됨 (${agoText})` : `Expired (${agoText})`,
              class: 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300'
            };
          }
        }

        if (payload.nbf && payload.nbf > now) {
          return {
            status: 'not-yet',
            message: lang === 'ko' ? '아직 유효하지 않음 (nbf)' : 'Not yet valid (nbf)',
            class: 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-700 dark:text-yellow-300'
          };
        }

        if (payload.exp) {
          const remaining = payload.exp - now;
          const days = Math.floor(remaining / 86400);
          const hours = Math.floor((remaining % 86400) / 3600);
          const mins = Math.floor((remaining % 3600) / 60);

          let remainText;
          if (lang === 'ko') {
            remainText = days > 0 ? `${days}일 ${hours}시간 남음` : hours > 0 ? `${hours}시간 ${mins}분 남음` : `${mins}분 남음`;
          } else {
            remainText = days > 0 ? `${days}d ${hours}h remaining` : hours > 0 ? `${hours}h ${mins}m remaining` : `${mins}m remaining`;
          }

          return {
            status: 'valid',
            message: lang === 'ko' ? `유효함 (${remainText})` : `Valid (${remainText})`,
            class: 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-300'
          };
        }

        return {
          status: 'unknown',
          message: lang === 'ko' ? '만료 시간 없음' : 'No expiration',
          class: 'bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300'
        };
      }

      // Decode JWT
      function decodeJWT() {
        const jwt = jwtInput.value.trim();

        // Reset
        errorMessage.classList.add('hidden');
        results.classList.add('hidden');

        if (!jwt) {
          errorMessage.textContent = t('tools.jwtDecoder.enterToken');
          errorMessage.classList.remove('hidden');
          return;
        }

        // Split JWT
        const parts = jwt.split('.');
        if (parts.length !== 3) {
          errorMessage.textContent = t('tools.jwtDecoder.invalidFormat');
          errorMessage.classList.remove('hidden');
          return;
        }

        try {
          // Decode header
          const headerStr = base64UrlDecode(parts[0]);
          const header = JSON.parse(headerStr);

          // Decode payload
          const payloadStr = base64UrlDecode(parts[1]);
          const payload = JSON.parse(payloadStr);

          // Store decoded data
          decodedData = {
            header: header,
            payload: payload,
            signature: parts[2]
          };

          // Display results
          displayResults(parts, header, payload);

        } catch (e) {
          errorMessage.textContent = t('tools.jwtDecoder.decodeFailed') + ': ' + e.message;
          errorMessage.classList.remove('hidden');
        }
      }

      // Display results
      function displayResults(parts, header, payload) {
        const lang = getCurrentLang();

        // Token preview
        tokenPreview.innerHTML = `<span class="token-header">${parts[0]}</span>.<span class="token-payload">${parts[1]}</span>.<span class="token-signature">${parts[2]}</span>`;

        // Token status
        const status = getTokenStatus(payload);
        tokenStatus.className = `mb-6 p-4 rounded-xl ${status.class}`;
        tokenStatus.innerHTML = `
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              ${status.status === 'valid' ?
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>' :
                status.status === 'expired' ?
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>' :
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>'}
            </svg>
            <span class="font-medium">${status.message}</span>
          </div>
        `;

        // Header JSON
        headerJson.textContent = JSON.stringify(header, null, 2);

        // Payload JSON
        payloadJson.textContent = JSON.stringify(payload, null, 2);

        // Signature
        signatureValue.textContent = parts[2];

        // Claims list
        const timestampClaims = ['exp', 'nbf', 'iat'];
        const claimDescriptions = {
          iss: lang === 'ko' ? '발급자' : 'Issuer',
          sub: lang === 'ko' ? '주제' : 'Subject',
          aud: lang === 'ko' ? '대상' : 'Audience',
          exp: lang === 'ko' ? '만료 시간' : 'Expiration',
          nbf: lang === 'ko' ? '유효 시작' : 'Not Before',
          iat: lang === 'ko' ? '발급 시간' : 'Issued At',
          jti: lang === 'ko' ? '토큰 ID' : 'JWT ID'
        };

        let claimsHtml = '';
        for (const [key, value] of Object.entries(payload)) {
          let displayValue = value;
          let extra = '';

          if (timestampClaims.includes(key) && typeof value === 'number') {
            displayValue = value;
            extra = `<span class="text-xs text-gray-500 dark:text-gray-400 ml-2">(${formatTimestamp(value)})</span>`;

            // Add status indicator for exp
            if (key === 'exp') {
              const now = Math.floor(Date.now() / 1000);
              if (value < now) {
                extra += `<span class="ml-2 px-1.5 py-0.5 text-xs bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded">${lang === 'ko' ? '만료됨' : 'Expired'}</span>`;
              }
            }
          } else if (typeof value === 'object') {
            displayValue = JSON.stringify(value);
          }

          const description = claimDescriptions[key] ? ` <span class="text-xs text-gray-400">(${claimDescriptions[key]})</span>` : '';

          claimsHtml += `
            <div class="claim-row">
              <span class="claim-key">${key}${description}</span>
              <span class="claim-value">${displayValue}${extra}</span>
            </div>
          `;
        }

        claimsList.innerHTML = claimsHtml || `<p class="text-gray-500 dark:text-gray-400 text-sm">${lang === 'ko' ? '클레임 없음' : 'No claims'}</p>`;

        results.classList.remove('hidden');
      }

      // Verify signature using Web Crypto API
      async function verifySignature() {
        const jwt = jwtInput.value.trim();
        const secret = secretKeyInput.value;
        const lang = getCurrentLang();

        if (!jwt || !decodedData.header) {
          toast.warning(t('tools.jwtDecoder.decodeFirst'));
          return;
        }

        if (!secret) {
          toast.warning(t('tools.jwtDecoder.enterSecret'));
          return;
        }

        const alg = decodedData.header.alg;
        const parts = jwt.split('.');
        const data = parts[0] + '.' + parts[1];

        // Check if algorithm is supported
        const algMap = {
          'HS256': { name: 'HMAC', hash: 'SHA-256' },
          'HS384': { name: 'HMAC', hash: 'SHA-384' },
          'HS512': { name: 'HMAC', hash: 'SHA-512' }
        };

        if (!algMap[alg]) {
          verifyResult.className = 'mt-2 p-2 rounded text-sm bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300';
          verifyResult.textContent = lang === 'ko'
            ? `${alg} 알고리즘은 지원되지 않습니다. HMAC(HS256/384/512)만 지원됩니다.`
            : `Algorithm ${alg} is not supported. Only HMAC (HS256/384/512) is supported.`;
          verifyResult.classList.remove('hidden');
          return;
        }

        try {
          const encoder = new TextEncoder();
          const keyData = encoder.encode(secret);
          const dataBytes = encoder.encode(data);

          const cryptoKey = await crypto.subtle.importKey(
            'raw',
            keyData,
            algMap[alg],
            false,
            ['sign']
          );

          const signatureBytes = await crypto.subtle.sign(
            algMap[alg].name,
            cryptoKey,
            dataBytes
          );

          // Convert computed signature to base64url
          const computedSig = btoa(String.fromCharCode(...new Uint8Array(signatureBytes)))
            .replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');

          // Compare with original signature
          const isValid = computedSig === parts[2];

          if (isValid) {
            verifyResult.className = 'mt-2 p-2 rounded text-sm bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300';
            verifyResult.innerHTML = `<span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> ${lang === 'ko' ? '서명이 유효합니다!' : 'Signature is valid!'}</span>`;
          } else {
            verifyResult.className = 'mt-2 p-2 rounded text-sm bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300';
            verifyResult.innerHTML = `<span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg> ${lang === 'ko' ? '서명이 일치하지 않습니다.' : 'Signature does not match.'}</span>`;
          }
          verifyResult.classList.remove('hidden');

        } catch (e) {
          verifyResult.className = 'mt-2 p-2 rounded text-sm bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300';
          verifyResult.textContent = lang === 'ko' ? '검증 중 오류가 발생했습니다.' : 'Error during verification.';
          verifyResult.classList.remove('hidden');
        }
      }

      // Event listeners
      decodeBtn.addEventListener('click', decodeJWT);
      verifyBtn.addEventListener('click', verifySignature);

      jwtInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
          decodeJWT();
        }
      });

      // Auto-decode on paste
      jwtInput.addEventListener('paste', () => {
        setTimeout(decodeJWT, 100);
      });

      pasteBtn.addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          jwtInput.value = text;
          decodeJWT();
        } catch (e) {
          toast.error(t('common.pasteError'));
        }
      });

      // Copy part buttons
      document.querySelectorAll('.copy-part-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const part = btn.dataset.part;
          let text = '';

          if (part === 'header') {
            text = JSON.stringify(decodedData.header, null, 2);
          } else if (part === 'payload') {
            text = JSON.stringify(decodedData.payload, null, 2);
          } else if (part === 'signature') {
            text = decodedData.signature;
          }

          await copyToClipboard(text);
          toast.success(t('common.copied'));
        });
      });

      // Update UI on language change
      function updateUI() {
        if (!results.classList.contains('hidden') && decodedData.payload) {
          const jwt = jwtInput.value.trim();
          const parts = jwt.split('.');
          displayResults(parts, decodedData.header, decodedData.payload);
        }
      }

      // Listen for language change
      document.addEventListener('i18nApplied', updateUI);
    })();
  </script>
</body>
</html>
